---
title: "[WIP] 现代化React开发最佳实践"
date: 2021-12-02T15:00:46+08:00
---

显然，Hooks 目前正大行其道。那么，Class 究竟有哪些弊端？它又有哪些优势呢？

## **Class 的弊端**

1. **TypeScript 类型定义复杂**  
   - 在使用 TypeScript 时，Class 需要定义大量的类型（如接口、类属性等），而 Hooks 函数可以通过更简洁的方式实现相同功能。

2. **HOC 嵌套地狱**  
   - 使用 Class 组件时，HOC（高阶组件）的层层嵌套问题较为突出。这种嵌套通常通过迭代器模式实现，容易导致代码复杂度增加。  
   - Hooks 则通过组合模式很好地规避了这个问题，使得逻辑更加清晰。

3. **Props 消费黑盒问题**  
   - HOC 的 Props 下传过程存在“消费黑盒”现象，排查难度较大。某些 Props 可能丢失或未正确传递，从而导致渲染异常。

4. **多个 HOC 的依赖关系**  
   - 多个 HOC 之间可能存在前后依赖关系，增加了代码维护和调试的复杂性。

---

## **Class 的优势**

尽管 Hooks 更加流行，但 Class 组件在某些场景下仍然具有独特的优势：

1. **数据实体消费清晰**  
   - Class 组件基于面向对象的设计思想，数据实体的结构更加清晰，而不是散落在各个字段中。

2. **扩展性强**  
   - 对数据处理的扩展非常方便，只需新增方法即可完成对数据的操作。

3. **数据关联关系明确**  
   - 数据之间的关联关系可以通过类型判断清晰理解，便于维护和扩展。

4. **多数据判断更直观**  
   - 在需要根据多个数据进行 UI 渲染或交互时，Class 组件的表现更为直观。

---

## **最佳实践建议**

结合两者的优缺点，推荐以下实践：
- **数据模型**：借助 Class 实现，利用装饰器、类元数据和依赖注入，将数据、服务和消费灵活组合。这种方式可以避免传统目录规定或特殊命名规则带来的限制，提升开发效率。
- **组件渲染**：借助 Hooks 实现，利用其简洁性和组合能力，简化组件逻辑。

---

## **如何进行状态管理？**

> **破窗效应**  
> Hooks 的状态管理存在不共享、不持久的问题，数据往往是多份的，这可能导致状态同步困难。

以下是几种常见的状态管理方案及其优缺点：

### **方案 1: [umi/hox](https://github.com/umijs/hox)**

#### **优点**
1. **持久化与全局共享**  
   - 数据可以在全局范围内共享，并支持持久化存储。
2. **灵活订阅机制**  
   - 支持订阅更新和非订阅更新，开发者可以根据需求选择是否监听状态变化。

#### **缺点**
1. **持久化与非持久化的界限模糊**  
   - 如何区分持久化和非持久化的状态？例如，`createModel` 的设计是否存在边界？
2. **缺少 DevTools 支持**  
   - 无法通过工具查看状态的变化过程，调试难度较大。
3. **副作用处理能力不足**  
   - 是否可以在 Model 中直接编写副作用逻辑？这一点尚不明确。

---

### **方案 2: Redux**

Redux 是一种经典的状态管理工具，适用于大型项目。  
- **优点**：状态集中管理，支持时间旅行调试（DevTools）。  
- **缺点**：学习曲线较陡，代码量较多，容易导致样板代码膨胀。

---

### **方案 3: Dva**

Dva 是基于 Redux 的封装，提供了更简洁的 API 和内置的异步处理能力。  
- **优点**：内置了 Redux-Saga，简化了异步逻辑的处理。  
- **缺点**：灵活性不如原生 Redux，可能不适合复杂的业务场景。

---

### **方案 4: MobX**

MobX 提供了一种响应式的状态管理方式，适合中小型项目。  
- **优点**：使用简单，代码量少，状态变化自动触发视图更新。  
- **缺点**：对于大型项目，状态的可追踪性和调试能力可能不足。

---

### **方案 5: Immer**

Immer 是一个不可变数据管理库，常用于简化状态更新逻辑。  
- **优点**：通过简单的 API 实现不可变数据操作，代码更易读。  
- **缺点**：仅解决状态更新问题，需与其他状态管理工具配合使用。

---

## **总结**

- **Class vs Hooks**：  
  - Class 在数据模型和复杂逻辑处理上更具优势，而 Hooks 则更适合组件渲染和逻辑复用。  
  - 推荐将两者结合使用，发挥各自的优势。

- **状态管理**：  
  - 根据项目规模和需求选择合适的状态管理工具。  
  - 小型项目可以考虑 MobX 或 Immer，而大型项目则更适合 Redux 或 Dva。  
  - 如果需要持久化和全局共享，可以尝试 `umi/hox`，但需要注意其局限性。