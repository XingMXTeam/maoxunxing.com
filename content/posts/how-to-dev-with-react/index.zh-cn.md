---
title: "[WIP] 现代化React开发最佳实践"
date: 2021-12-02T15:00:46+08:00
---

## hooks 还是 class?

显然 hooks 目前正大行其道。 class 有啥弊端呢？
1 一般 class 结合 typescript 时，需要定义一堆的类型，而 Hooks 函数能简化
2 hooks 能规避掉 HOC 的嵌套地狱，HOC 层层嵌套一般通过迭代器模式实现，hooks 通过组合模式能很好规避这个问题
3 HOC 存在消费黑盒，props 下传排查难度大，可能某些 props 丢失导致渲染异常
4 多个 HOC 使用存在前后依赖关系

class 有啥好处？
1 消费数据实体的时候，非常清晰。因为面向对象的缘故，而不是散落的字段
2 扩展方便。需要扩展对数据的处理，只要新增方法就行
3 数据之间的关联关系，通过类型判断能清晰理解
4 多个数据判断做 UI 渲染或者交互时，会显得更清晰

所以数据模型借助 class， 而组件渲染借助 hooks。利用装饰器、类元数据、依赖注入，将数据、服务、消费灵活组合。以前需要借助目录规定定义、特殊命名规则定义来完成相互调用和组合。借助装饰器可以在项目任意位置进行自由组合。

## 如何状态管理

> 破窗效应

Hooks 状态不共享，不持久，数据是多份

方案 1: [umi/hox](https://github.com/umijs/hox)  
优点：

1 持久化，数据全局共享    
2 支持订阅更新和不订阅更新    

缺点：
1 持久化和非持久的界限： createModel?  
2 缺少 devtools？无法查看变化的状态  
3 可否在 model 里面写副作用？  

方案 2: Redux  
方案 3: Dva  
方案 4: mobx  
方案 5: immer  
