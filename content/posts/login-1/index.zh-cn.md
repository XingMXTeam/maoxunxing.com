---
title: "免登方案详解"
date: 2025-02-06
tags:
  - Web开发
---

## 目录
1. [问题场景](#问题场景)
2. [解决方案](#解决方案)
   - [方案 1：通过免登接口实现](#方案-1通过免登接口实现)
   - [方案 2：通过 Token 实现](#方案-2通过-token实现)
3. [安全性与兜底措施](#安全性与兜底措施)
4. [总结](#总结)

---

## 问题场景

A 站点内嵌 B 站点，两个站点的域名不同。需要实现 A 站点用户免登录跳转到 B 站点。

---

## 解决方案

### 方案 1：通过免登接口实现

- **实现方式**  
  A 站点通过调用 B 站点提供的免登接口，携带必要的参数（如重定向地址、语言等），实现用户的免登录跳转。
  
- **关键点**
  - **重定向参数**：用于跳转回目标页面。
  - **其他必要参数**：如语言，用于切换 B 站点的语言环境。
  
- **限制**
  - 如果浏览器禁用了第三方 Cookie，则无法将 Cookie 写入 B 站点，导致免登失败。

---

### 方案 2：通过 Token 实现

- **实现方式**  
  A 站点请求服务端换取一个临时 Token，然后通过 iframe 访问 B 站点的免登 URL，并将 Token 传递给 B 站点。

- **关键点**
  - **Token 传递方式**  
    - 推荐通过请求头传递 Token，避免将敏感信息暴露在 URL 中。
  - **Token 时效性**  
    - 设置合理的 Token 有效期，确保安全性。
  - **来源验证**  
    - 验证 Token 的来源是否合法，防止伪造请求。
  - **异常监控**  
    - 对免登过程中的异常情况进行监控，及时发现问题。
  - **HTTPS 安全性**  
    - 确保所有通信都通过 HTTPS 进行，防止中间人攻击。

- **兜底页面**  
  - B 站点需提供一个统一的免登失败兜底页面，用于处理免登失败的情况。

---

## 安全性与兜底措施

1. **安全性**
   - **Token 安全性**  
     - 使用短时效 Token，减少泄露风险。
     - 验证 Token 的合法性，确保其由可信服务端签发。
   - **HTTPS 加密**  
     - 所有通信必须使用 HTTPS，防止数据被窃取或篡改。
   - **来源校验**  
     - 校验请求来源，防止跨站攻击。

2. **兜底措施**
   - **免登失败页面**  
     - 提供友好的免登失败页面，引导用户手动登录或其他操作。
   - **日志记录**  
     - 记录免登过程中的关键日志，便于排查问题。

---

## 总结

通过上述两种方案，可以实现 A 站点到 B 站点的免登录跳转。方案 1 适用于简单的场景，但受限于第三方 Cookie 的支持情况；方案 2 更加灵活和安全，适合复杂场景下的免登需求。无论采用哪种方案，都需要注重安全性设计，并提供兜底措施以应对异常情况，从而保障用户体验和系统稳定性。
