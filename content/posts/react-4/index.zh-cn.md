---
title: "React Server Component"
description: "React Server Component是什么？"
date: 2024-08-18
tags:
  - React
images:
  - react-1/a.png
---

## 目录

1. [设计初衷](#设计初衷)
2. [什么是 RSC？](#什么是-rsc)
3. [如何实现 RSC？](#如何实现-rsc)
4. [核心方法解析](#核心方法解析)
5. [RSC 与 SSR 的关系](#rsc-与-ssr-的关系)
6. [总结](#总结)

---

## 设计初衷

React Server Components（RSC）的引入旨在提升 React 应用的性能和开发体验，主要体现在以下几个方面：

### 1. 减少客户端 JavaScript 负载
- **特点**：RSC 允许开发者将部分逻辑留在服务器端执行，减少需要发送到客户端的 JavaScript 代码量。
- **优势**：显著提升应用的加载性能，尤其对于大型应用或复杂页面。

### 2. 更高效的数据获取
- **特点**：RSC 能够在服务器端直接获取数据并渲染组件。
- **优势**：避免了客户端额外的网络请求，减少了延迟。

### 3. 优化 SEO 和初始加载性能
- **特点**：初次加载时就能向客户端返回完整的 HTML 页面。
- **优势**：搜索引擎更容易抓取内容，同时提升了用户的首次访问体验。

### 4. 提高开发体验
- **特点**：可以在同一个项目中混合使用客户端组件和服务器组件。
- **优势**：开发者可以根据需求灵活选择组件类型，简化开发流程。

### 5. 更好地利用服务器资源
- **特点**：充分利用服务器的计算资源，减轻客户端设备的负担。
- **优势**：特别适合移动设备或低性能设备用户，提供更流畅的体验。

---

## 什么是 RSC？

通过服务端将 JSX（这里的 JSX 就是 RSC 组件）转换为 HTML，然后发送给客户端进行渲染。这就是服务端渲染（SSR）。  
RSC 的核心思想是通过 JS 发送请求获取最新的区块 HTML，并通过水合替换区块内容。

### 特点
1. **无感刷新**：只更新特定区块的内容，其他区块的状态保持不变。
2. **劫持 `<a>` 标签点击**：通过 `pushState` 模拟页面刷新，结合 RSC 组件的方式替换刷新内容，从而实现无感替换。

---

## 如何实现 RSC？

### 服务端渲染流程
1. **字符串返回 HTML**  
   正常情况下，服务端可以直接将 HTML 字符串返回给客户端。
   
2. **使用 Babel 插件处理 JSX**  
   - 使用 `node-jsx-loader` 插件，可以在服务端编写 JSX。
   - 该插件会将 JSX 转换为一个 JS 对象（包含 `type` 和 `props`），这个对象可以进一步转换为 HTML 并发送给客户端。

---

## 核心方法解析

### 1. `renderJSXToClientJSX`
- **作用**：服务端将 JSX 组件转换为 JSX 对象，然后将其序列化为 JSON 传递给客户端。
- **优势**：客户端接收到 JSON 后，可以直接更新 DOM，无需重新加载整个页面。

### 2. `renderToString`
- **作用**：将 JSX 转换为字符串形式的 HTML，发送到浏览器后由客户端进行水合（Hydration）。
- **适用场景**：适用于传统的 SSR 场景。

---

## RSC 与 SSR 的关系

- **独立但可结合**  
  服务器组件（RSC）和服务器渲染（SSR）是两种独立的技术，但它们可以结合使用，构建跨服务器和客户端的应用程序。
  
- **区别**  
  - **SSR**：产出的是 HTML。
  - **RSC**：产出的是指令，用于指导客户端如何更新特定区块的内容。

---

## 总结

React Server Components 的引入为现代 Web 应用带来了诸多优势：
- 减少了客户端 JavaScript 的负载，提升了加载性能。
- 在服务器端完成数据获取和渲染，优化了用户体验。
- 支持无感刷新和状态保持，增强了交互体验。
- 灵活的开发模式允许开发者根据需求自由选择组件类型。

通过 `renderJSXToClientJSX` 和 `renderToString` 等核心方法，RSC 实现了高效的跨端协作。未来，随着技术的不断发展，RSC 将继续为开发者提供更强大的工具来构建高性能、高体验的 Web 应用。

---

### 参考资料
- [CSR 协议介绍](https://juejin.cn/post/7244452476190752829)