---
title: "[WIP] A/B实验的理解"
date: 2021-09-09
tags:
  - A/B Test
  - User Growth
description: ""
images:
  - ab-test/ab.png
---


## AB实验的原理

假设检验，通过反证法，如果一件小概率事件发生了，说明有差异。比如一个人宣称他是中等水平射手，但是让他射箭第一次就2环，这个是小概率事件（p值），但是发生了，可以说明他大概率不是中等水平的射手。

涉及原理： 概率论大数定律和中心极限定理

## AB实验的作用

定性效果：业务策略是否有效（看p值）； 定量：具体增长了多少（看置信区间）

p值是“假设”和“数据”的关系。不代表关联度或者是否有效。只是表示是否显著。一般取低于0.05表示显著。

置信区间：若实验推全，分组之间真实差异有95%的可能在这个取值范围内，也就是大概率指标会差多少。如果上下限都大于0 表示显著。如果包含0，表示不显著。

## 正交实验

前提是避免实验目标一致，如果目标一致应该采用互斥（非正交实验）。通过统一分流SDK，对id随机打散保证不重复(MurmurHash:uid+salt)。

## 联合实验

是判断一组/个业务策略对全局的影响，不看不相关的多个业务策略的全局影响。

## 案例
怎么理解AB实验的基准桶和实验桶转化率问题。实验桶采用新算法；基准桶采用旧算法；实验桶5%流量，基准桶10%流量，一段时间后前者86%，后者90%。 

还要看假设检验也就是p值是多少。假设p值是为0.015说明新算法比旧算法好4%，甚至好更多的概率是0.015。

## 分流原理

《overlapping experiment infrastructure: more, better, faster experimentation》

## 其他资料

H0: A、B 没有本质差异
H1: A、B 确实存在本质差异

p 值： 根据 z 检验算出 p 值，如果 p<0.05，则取 H0
置信区间：是一个我们相当肯定会包含真实值的数据范围 比如 95%置信区间 在[0.88, 0.97]范围内。 因为是采样，所以结果有好（在置信区间的数值范围内）有坏（不在范围内）。

[解释](https://www.shuxuele.com/data/confidence-interval.html)


## AB实验和定投的区别

AB流量是随机的，定投是定向投放。

## 创建实验

创建实验流程： 是先配置模块实验，发布实验（实验桶还没分配），发布新增的实验模块，再发布页面生效。 然后逐步提高实验桶占比（**也就是上线不开量**）。

发布实验：就是发布到diamond或者tair（这个是和模块相关的）

## 分流逻辑

全局实验：

客户端接实验SDK进行分流，接口调用的时候，服务端拿到的是一个大Map（K/V对象），再根据分流信息做差异化楼层下发。

前端实现是：服务端把实验桶信息在cookie里种下，接口请求时给到服务端，服务端有一个根据这个桶信息获得对应规则下发不同的组件名称。前端根据这个名称渲染不同的组件。

单楼层实验：
从实验平台获取实验，业务关联实验id。

## 实验固化

- 页面实验固化: 走方案路由（路由到页面），然后实验下线。这里的方案路由就是一个配置。  
- 单模块实验固化: 先实验下线（实验下线后，会命中自然桶），然后把非优胜的模块删除。  
- 全链路实验固化：会自动把楼层删掉并发布页面结构。如果实验未推全，则**自然桶要保留不能直接把所有排期过期**  

> 因为客户端全局实验冷启动的时候，切shipto或者onboarding欢迎页进来时会分流，这个时候会把实验数据统一放到内存。为什么这么做？是为了避免上下游的开关不一致。 也就是说即便实验下线，因为用户的app还保留了之前的实验开关，会有流量进来，还是会有用户命中自然桶。除非用户killApp重新启动。


## 几个问题

1. 单楼层实验如何分流 ？



