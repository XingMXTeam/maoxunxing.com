<!DOCTYPE html>
<html lang="zh-cn">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Xunxing Mao">
    <meta name="description" content="Updates about my life and what I learn about creating software">
    <meta name="keywords" content="blog,developer,personal,æ¯›è®­æ˜Ÿ,maoxunxing">

    <meta name="twitter:card" content="summary_large_image"/>


    <meta name="twitter:site" content="@maoxunxing"/>
    <meta name="twitter:creator" content="@maoxunxing"/>


    <meta property="og:title" content="NodeJS Streamä»å…¥é—¨åˆ°ç²¾é€š" />
<meta property="og:description" content="æµæ˜¯nodejsä¸­æœ€éš¾ç†è§£ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæœ¬æ–‡å¯¹æµçš„å†…å®¹åšäº†æ¢³ç†" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://maoxunxing.com/zh-cn/nodejs-network-stream/" />

<meta property="og:image" content="https://maoxunxing.com/nodejs-network-stream/images.jpeg" />
<meta property="article:published_time" content="2021-10-19T14:28:57+08:00" />
<meta property="article:modified_time" content="2021-10-19T14:28:57+08:00" /><meta property="og:site_name" content="æ¯›è®­æ˜Ÿçš„ç½‘ç»œæ—¥å¿—" />


    
      <base href="https://maoxunxing.com/zh-cn/nodejs-network-stream/">
    
    <title>NodeJS Streamä»å…¥é—¨åˆ°ç²¾é€š Â· æ¯›è®­æ˜Ÿçš„ç½‘ç»œæ—¥å¿—</title>

    
      <link rel="canonical" href="https://maoxunxing.com/zh-cn/nodejs-network-stream/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Rubik:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous" />
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.min.css@8.0.1/normalize.min.css" integrity="sha256-oeib74n7OcB5VoyaI+aGxJKkNEdyxYjd2m3fi/3gKls=" crossorigin="anonymous">
    
    
    

    
      
      
      <link rel="stylesheet" href="https://maoxunxing.com/css/coder.min.8b74f2a917b62bc11fd3bb6cdbb2f369faa9711339338533e3cf2d9997c70b38.css" integrity="sha256-i3TyqRe2K8Ef07ts27LzafqpcRM5M4Uz488tmZfHCzg=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://maoxunxing.com/css/coder-dark.min.83a2010dac9f59f943b3004cd6c4f230507ad036da635d3621401d42ec4e2835.css" integrity="sha256-g6IBDayfWflDswBM1sTyMFB60DbaY102IUAdQuxOKDU=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="https://maoxunxing.com/css/main.css" />
    

    

    

    <link rel="icon" type="image/png" href="https://maoxunxing.com/images/favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://maoxunxing.com/images/favicon/favicon-16x16.png" sizes="16x16">

    
      <link rel="alternate" type="application/rss+xml" href="https://maoxunxing.com//index.xml" title="æ¯›è®­æ˜Ÿçš„ç½‘ç»œæ—¥å¿—" />
    <meta name="generator" content="Hugo 0.80.0" />
  </head>

  
  
    
  
  <body class="colorscheme-auto">
    
<div class="float-container">
    
</div>


    <main class="wrapper">
      
<nav class="navigation">
  <section class="container">
    <div class="navigation-author">
      <a class="navigation-avatar" href="https://maoxunxing.com/zh-cn">
        
          <img src="https://maoxunxing.com/images/avatar.jpg" alt="Author photo">
        
      </a>
      <a class="name" href="https://maoxunxing.com/zh-cn">è®­æ˜Ÿä¸ªäººç«™</a>
    </div>

    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://maoxunxing.com/zh-cn/posts/">åšå®¢</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://maoxunxing.com/zh-cn/projects/">é¡¹ç›®</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://maoxunxing.com/zh-cn/book-reports/">è¯»ä¹¦æŠ¥å‘Š</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://maoxunxing.com/zh-cn/about/">å…³äº</a>
          </li>
        
      

      
        
        
        
          
            
              <li class="navigation-item menu-separator">
                <span>|</span>
              </li>
              
            
            <li class="navigation-item">
              
              <a href="https://maoxunxing.com/zh-cn/notes" class="router-link-active router-link-exact-active" title="Notes" data-v-939756fc="" aria-current="page"><svg class="inline" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" data-v-939756fc="" style="vertical-align: sub;"><path d="M21 15l-6 5.996L4.002 21A.998.998 0 0 1 3 20.007V3.993C3 3.445 3.445 3 3.993 3h16.014c.548 0 .993.456.993 1.002V15zM19 5H5v14h8v-5a1 1 0 0 1 .883-.993L14 13l5-.001V5zm-.829 9.999L15 15v3.169l3.171-3.17z" fill="currentColor"></path></svg></a>
              
            </li>
            <li class="navigation-item">
              <a href="https://github.com/XingMXTeam/" target="_blank" title="GitHub" data-v-939756fc=""><svg class="inline" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" data-v-939756fc="" style="vertical-align: sub;"><path d="M10.07 20.503a1 1 0 0 0-1.18-.983c-1.31.24-2.963.276-3.402-.958a5.708 5.708 0 0 0-1.837-2.415a1.2 1.2 0 0 1-.167-.11a1 1 0 0 0-.93-.645h-.005a1 1 0 0 0-1 .995c-.004.815.81 1.338 1.141 1.514a4.44 4.44 0 0 1 .924 1.36c.365 1.023 1.423 2.576 4.466 2.376l.003.098l.004.268a1 1 0 0 0 2 0l-.005-.318c-.005-.19-.012-.464-.012-1.182zM20.737 5.377c.032-.125.063-.264.09-.42a6.278 6.278 0 0 0-.408-3.293a1.002 1.002 0 0 0-.615-.58c-.356-.12-1.67-.357-4.184 1.25a13.87 13.87 0 0 0-6.354 0C6.762.75 5.455.966 5.102 1.079a.997.997 0 0 0-.631.584a6.3 6.3 0 0 0-.404 3.357c.025.127.051.246.079.354a6.27 6.27 0 0 0-1.256 3.83a8.422 8.422 0 0 0 .043.921c.334 4.603 3.334 5.984 5.424 6.459a4.591 4.591 0 0 0-.118.4a1 1 0 0 0 1.942.479a1.678 1.678 0 0 1 .468-.878a1 1 0 0 0-.546-1.745c-3.454-.395-4.954-1.802-5.18-4.899a6.61 6.61 0 0 1-.033-.738a4.258 4.258 0 0 1 .92-2.713a3.022 3.022 0 0 1 .195-.231a1 1 0 0 0 .188-1.025a3.388 3.388 0 0 1-.155-.555a4.094 4.094 0 0 1 .079-1.616a7.543 7.543 0 0 1 2.415 1.18a1.009 1.009 0 0 0 .827.133a11.777 11.777 0 0 1 6.173.001a1.005 1.005 0 0 0 .83-.138a7.572 7.572 0 0 1 2.406-1.19a4.04 4.04 0 0 1 .087 1.578a3.205 3.205 0 0 1-.169.607a1 1 0 0 0 .188 1.025c.078.087.155.18.224.268A4.122 4.122 0 0 1 20 9.203a7.039 7.039 0 0 1-.038.777c-.22 3.056-1.725 4.464-5.195 4.86a1 1 0 0 0-.546 1.746a1.63 1.63 0 0 1 .466.908a3.06 3.06 0 0 1 .093.82v2.333c-.01.648-.01 1.133-.01 1.356a1 1 0 1 0 2 0c0-.217 0-.692.01-1.34v-2.35a4.881 4.881 0 0 0-.155-1.311a4.256 4.256 0 0 0-.116-.416a6.513 6.513 0 0 0 5.445-6.424A8.697 8.697 0 0 0 22 9.203a6.13 6.13 0 0 0-1.263-3.826z" fill="currentColor"></path></svg></a>
            </li>
            
            <li class="navigation-item">
              <a href="https://www.douban.com/people/maoxingxing/" target="_blank" title="douban" class="lt-md:hidden" data-v-939756fc=""><svg t="1637423568461" class="icon douban" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4782" width="1.2em" height="1.2em"><path d="M715.824 611.542h-395.425c42.209 71.089 82.194 148.841 115.519 228.812h162.166c48.875-75.533 88.861-151.060 117.739-228.812zM762.474 524.904v-168.833h-486.503v168.833h486.503zM960.187 929.214h-888.596v-86.637h266.579c-33.322-71.089-66.646-133.289-102.189-184.386l68.865-44.427h-119.961v-346.555h675.334v346.555h-126.623l68.865 44.427c-33.322 71.089-66.646 133.289-99.966 184.386h259.916v86.637zM940.196 165.023h-841.946v-86.637h841.946v86.637z" fill="currentColor" p-id="4783"></path></svg></a>
            </li>
            <li class="navigation-item">
              <a href="https://twitter.com/maoxunxing/" target="_blank" title="Twitter" data-v-939756fc=""><svg class="inline" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" data-v-939756fc="" style="vertical-align: sub;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53a4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></g></svg></a>
            </li>
            <li class="navigation-item">
              <a href="https://maoxunxing.com/en/posts/index.xml" target="_blank" title="RSS" class="lt-md:hidden" data-v-939756fc=""><svg class="inline rss" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" data-v-939756fc="" style="vertical-align: sub; font-size: 2rem; margin: 0px -0.125rem;"><path d="M5 5v22h22V5zm2 2h18v18H7zm5 3c-.684 0-1.355.055-2 .188v2.062a7.86 7.86 0 0 1 2-.25c4.41 0 8 3.59 8 8c0 .691-.086 1.36-.25 2h2.063A9.923 9.923 0 0 0 22 20c0-5.516-4.484-10-10-10zm0 4a5.96 5.96 0 0 0-2 .344v2.219A3.968 3.968 0 0 1 12 16c2.207 0 4 1.793 4 4c0 .73-.219 1.41-.563 2h2.22A5.96 5.96 0 0 0 18 20c0-3.309-2.691-6-6-6zm0 4a1.999 1.999 0 1 0 0 4a1.999 1.999 0 1 0 0-4z" fill="currentColor"></path></svg></a>
            </li>
            <li class="navigation-item">
              <a href='javascript:void' id="dark-mode-toggle" title="Toggle Color Scheme">
                <svg class="inline dark-mode-icon" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" style="vertical-align: sub;"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A7.999 7.999 0 0 0 4 12z" fill="currentColor"></path></svg>
                <svg class="inline light-mode-icon" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" style="vertical-align: sub;"><path d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z" fill="currentColor"></path></svg>
              </a>
            </li>
            <li class="navigation-item" >
              <a href="https://maoxunxing.com/en/" id='languageMenu'>EN</a>
            </li>
          
        
          
        
      

    </ul>
  </section>
</nav>

<script>
  window.addEventListener('load', () => {
    const menu = document.getElementById('languageMenu')
    const arr = location.pathname.split("/");
    menu.setAttribute('href', menu.getAttribute('href') + (arr.length>=4 ? arr[arr.length-2]: ''))
  })
</script>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        
        <div class="post-title">
          <h1 class="title">NodeJS Streamä»å…¥é—¨åˆ°ç²¾é€š</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2021-10-19T14:28:57&#43;08:00'>
                October 19, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              8 åˆ†é’Ÿé˜…è¯»æ—¶é—´
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://maoxunxing.com/zh-cn/tags/nodejs/">NodeJS</a></div>

        </div>
      </header><div>
        <h2 id="ä»€ä¹ˆæ˜¯æµ">ä»€ä¹ˆæ˜¯æµ<a href="#ä»€ä¹ˆæ˜¯æµ" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h2>
<p>æµä¸æ˜¯ä»…å­˜åœ¨äºNodejs, åœ¨unixæ“ä½œç³»ç»Ÿä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ¦‚å¿µã€‚ æ¯”å¦‚ç®¡é“æ“ä½œç¬¦å·</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cat xx.ts | grep <span style="color:#d14">&#39;console.log&#39;</span>
</code></pre></div><p>èƒ½ä»æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„åŒ¹é…å†…å®¹ã€‚å®é™…ä¸Šï¼Œnodeçš„æµçš„æ¦‚å¿µæ˜¯æ¥æºäºunixç³»ç»Ÿï¼Œæœ€æ—©æ˜¯æ¥è‡ªDouglas McIlroyç®¡é“çš„æ¦‚å¿µ
<a href="http://cm.bell-labs.co/who/dmr/mdmpipe.html">æœ€åˆçš„æ¥æº</a>ã€‚</p>
<p>ç»´åŸºç™¾ç§‘ï¼š</p>
<blockquote>
<p>Malcolm Douglas McIlroy (born 1932) is a mathematician, engineer, and programmer. As of 2019 he is an Adjunct Professor of Computer Science at Dartmouth College. <strong>McIlroy is best known for having originally proposed Unix pipelines</strong> and developed several Unix tools, such as spell, diff, sort, join, graph, speak, and tr.[1] He was also one of the pioneering researchers of macro processors and programming language extensibility. He participated in the design of multiple influential programming languages, particularly PL/I, SNOBOL, ALTRAN, TMG and C++.</p>
</blockquote>
<p>æœ¬è´¨ä¸Šï¼Œæµæ˜¯ä¸€ç§æ•°æ®äº¤æ¢çš„æ ¼å¼ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨æ“ä½œæ–‡ä»¶çš„è¯»å†™ï¼Œç½‘ç»œä¼ è¾“ç­‰ã€‚ä¸ªäººè®¤ä¸ºæµæ˜¯nodejsä¸­æœ€éš¾ç†è§£ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„ä¸€ä¸ªç‰¹æ€§ã€‚</p>
<p>æµæ˜¯å¦å’Œæˆ‘ä»¬ç›¸å…³ï¼Œnodejsä¸­æµå‡ ä¹æ— å¤„ä¸åœ¨ã€‚æ¯”å¦‚è¯·æ±‚æµã€å“åº”æµã€æ–‡ä»¶æµã€‚æœç´¢ä¸€ä¸‹<a href="https://github.com/nodejs/node/blob/863d13c192a8d315fa274194e64c1c9e5820e8f2/lib/internal/console/constructor.js">Nodeè¿è¡Œæ—¶ä»£ç </a>ï¼Œéšå¤„å¯è§ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
  <span style="color:#000;font-weight:bold">if</span> (ignoreErrors <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">false</span>) <span style="color:#000;font-weight:bold">return</span> stream.write(string);

      <span style="color:#998;font-style:italic">// There may be an error occurring synchronously (e.g. for files or TTYs
</span><span style="color:#998;font-style:italic"></span>      <span style="color:#998;font-style:italic">// on POSIX systems) or asynchronously (e.g. pipes on POSIX systems), so
</span><span style="color:#998;font-style:italic"></span>      <span style="color:#998;font-style:italic">// handle both situations.
</span><span style="color:#998;font-style:italic"></span>      <span style="color:#000;font-weight:bold">try</span> {
        <span style="color:#998;font-style:italic">// Add and later remove a noop error handler to catch synchronous
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// errors.
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> (stream.listenerCount(<span style="color:#d14">&#39;error&#39;</span>) <span style="color:#000;font-weight:bold">===</span> <span style="color:#099">0</span>)
          stream.once(<span style="color:#d14">&#39;error&#39;</span>, noop);

        stream.write(string, errorHandler);
      } <span style="color:#000;font-weight:bold">catch</span> (e) {
        <span style="color:#998;font-style:italic">// Console is a debugging utility, so it swallowing errors is not
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// desirable even in edge cases such as low stack space.
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> (isStackOverflowError(e))
          <span style="color:#000;font-weight:bold">throw</span> e;
        <span style="color:#998;font-style:italic">// Sorry, there&#39;s no proper way to pass along the error here.
</span><span style="color:#998;font-style:italic"></span>      } <span style="color:#000;font-weight:bold">finally</span> {
        stream.removeListener(<span style="color:#d14">&#39;error&#39;</span>, noop);
...
</code></pre></div><h2 id="æ€ä¹ˆç”¨æµ">æ€ä¹ˆç”¨æµ<a href="#æ€ä¹ˆç”¨æµ" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h2>
<h3 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•<a href="#åŸºæœ¬ç”¨æ³•" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<p>è¿™æ®µä»£ç å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> http <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;http&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> fs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> server <span style="color:#000;font-weight:bold">=</span> http.createServer(<span style="color:#000;font-weight:bold">function</span>(req, res) {
  fs.readFile(__dirname <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;/data.txt&#39;</span>, (err, data) =&gt; {
    res.end(data)
  })
})
server.listen(<span style="color:#099">3000</span>)
</code></pre></div><p>åœ¨Nodejsé‡Œé¢æˆ‘ä»¬è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œæ˜¯è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œç„¶åå¤„ç†è¿™ä¸ªæ–‡ä»¶å†…å®¹ã€‚è¿™æ ·çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼šdata.txtä¼šè¯»å–åˆ°å†…å­˜ä¸­ï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒå˜å·®ï¼Œç‰¹åˆ«æ˜¯ä½ç½‘ç»œçš„æƒ…å†µã€‚
é€šè¿‡æµï¼Œå¯ä»¥ä¸€ä¸ªç‰‡æ®µä¸€ä¸ªç‰‡æ®µåœ°å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§éƒ½éƒ½è¯»å–åˆ°å†…å­˜é‡Œé¢ã€‚</p>
<p>é€šè¿‡æµçš„æ–¹å¼æ”¹å†™ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> http <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;http&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> fs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> server <span style="color:#000;font-weight:bold">=</span> http.createServer(<span style="color:#000;font-weight:bold">function</span>(req, res) {
  <span style="color:#000;font-weight:bold">const</span> stream <span style="color:#000;font-weight:bold">=</span> fs.createReadStream(__dirname <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;/data.txt&#39;</span>);
  stream.pipe(res)
})
server.listen(<span style="color:#099">3000</span>)
</code></pre></div><p>è¿™é‡Œpipeåšäº†ä¸¤ä»¶äº‹ï¼š1 æ˜¯ç›‘å¬æ•°æ® 2 ç›¸å½“äºè°ƒç”¨res.end å®ƒä¼šè‡ªåŠ¨ç®¡ç†æ•°æ®ç‰‡æ®µçš„ç¼“å­˜
ç”šè‡³æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ•°æ®å‹ç¼©ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> http <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;http&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> fs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> oppressor <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;oppressor&#39;</span>)

<span style="color:#000;font-weight:bold">const</span> server <span style="color:#000;font-weight:bold">=</span> http.createServer(<span style="color:#000;font-weight:bold">function</span>(req, res) {
  <span style="color:#000;font-weight:bold">const</span> stream <span style="color:#000;font-weight:bold">=</span> fs.createReadStream(__dirname <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;/data.txt&#39;</span>);
  stream.pipe(oppressor(req)).pipe(res)
})
server.listen(<span style="color:#099">3000</span>)
</code></pre></div><h3 id="æµçš„ç±»å‹">æµçš„ç±»å‹<a href="#æµçš„ç±»å‹" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<p>1 readable å¯è¯» <code>readable.pipe(A)</code>
2 writable å¯å†™ <code>A.pipe(writable)</code>
3 duplexï¼š å¤å¼ï¼šæ—¢å¯è¯»ä¹Ÿå¯å†™  <code>A.pipe(duplex).pipe(A)</code>
4 transformï¼šduplexçš„ä¸€ç§ç±»å‹ å¯è¯»å¯å†™ è¾“å‡ºæ˜¯ä»è¾“å…¥è½¬æ¢è¿‡æ¥ <code>A.pipe(transform).pipe(B)</code></p>
<p>pipeæ–¹æ³•:
æ‰€æœ‰çš„readable/transform/duplexæµéƒ½æœ‰è¿™ä¸ªæ–¹æ³•, å¹¶ä¸”è¿”å›readable/transform/duplexçš„æµ</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">src.pipe(dst) <span style="color:#998;font-style:italic">// è¿”å›ä¸€ä¸ªå¯è¯»çš„æµ æ‰€ä»¥å¯ä»¥é“¾å¼è°ƒç”¨ å’Œunixçš„ç®¡é“æ“ä½œç¬¦æ˜¯ä¸€æ ·çš„ æ¯”å¦‚ cat xx.txt | grep &#39;console&#39;
</span></code></pre></div><p>å¯è¯»æµçš„å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>stream.pipe(...)</code></li>
<li><code>stream.once('end', function() {})</code></li>
</ul>
<p>ä¸¤ç§æ¨¡å¼ï¼š é»˜è®¤æ˜¯æš‚åœæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ä½ éœ€è¦æ‰‹åŠ¨è°ƒç”¨next/readæ–¹æ³•ï¼Œå¯ä»¥å¼€å¯æµåŠ¨æ¨¡å¼</p>
<ul>
<li><code>stream.resume()</code></li>
<li><code>stream.on('data', function(buf) {}) </code> ç»‘å®šä¼šè‡ªåŠ¨è§¦å‘æµåŠ¨æ¨¡å¼</li>
</ul>
<p>èµ„æºçš„æ•°æ®æµå¹¶ä¸æ˜¯ç›´æ¥æµå‘æ¶ˆè´¹è€…ï¼Œè€Œæ˜¯å…ˆ push åˆ°ç¼“å­˜æ± ï¼Œæœ‰æ°´ä½ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ°´ä½ï¼Œpush çš„æ—¶å€™ä¼šè¿”å› falseï¼šæ¯”å¦‚</p>
<ul>
<li>æ¶ˆè´¹è€…ä¸»åŠ¨æ‰§è¡Œäº† .pause()</li>
<li>æ¶ˆè´¹é€Ÿåº¦æ¯”æ•°æ® push åˆ°ç¼“å­˜æ± çš„ç”Ÿäº§é€Ÿåº¦æ…¢</li>
</ul>
<p>éƒ½ä¼šè¿”å›false, è¿™ç§æƒ…å†µä¹Ÿå«åšã€ŒèƒŒå‹ã€Backpressure</p>
<p>å¯å†™æµçš„å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>.write(buf)</code></li>
<li><code>.end()</code></li>
<li><code>.end(buf)</code></li>
<li><code>.on('finish',function() {})</code></li>
<li>(&hellip;).pipe(stream)</li>
</ul>
<p>æ•°æ®æµå…ˆåˆ°èµ„æºæ± ï¼Œå¦‚æœå†™å…¥è¾ƒæ…¢æˆ–è€…æš‚åœï¼Œä¼šè¢«ç¼“å­˜ï¼›å¦‚æœå¤ªå¿«ï¼Œwriteä¼šè¿”å›false,è§¦å‘drainäº‹ä»¶</p>
<p>transform/duplexæµå¯ä»¥ç”¨ä¸Šé¢çš„æ‰€æœ‰æ–¹æ³•</p>
<h3 id="åˆ›å»ºå¯è¯»çš„æµreadablejsreadablejs">åˆ›å»ºå¯è¯»çš„æµï¼š<a href="./readable.js">readable.js</a><a href="#åˆ›å»ºå¯è¯»çš„æµreadablejsreadablejs" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> rs <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> (require(<span style="color:#d14">&#39;stream&#39;</span>).Readable);
rs.push(<span style="color:#d14">&#39;beep&#39;</span>);
rs.push(<span style="color:#000;font-weight:bold">null</span>); <span style="color:#998;font-style:italic">// nullå‘Šè¯‰æ¶ˆè´¹è€…æ•°æ®ç»“æŸ
</span><span style="color:#998;font-style:italic"></span>rs.pipe(process.stdout);
</code></pre></div><h3 id="åˆ›å»ºä¸€ä¸ªå¯å†™çš„æµ-writablejswritablejs">åˆ›å»ºä¸€ä¸ªå¯å†™çš„æµï¼š <a href="./writable.js">writable.js</a><a href="#åˆ›å»ºä¸€ä¸ªå¯å†™çš„æµ-writablejswritablejs" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> Stream <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> writableStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Stream.Writable(({
  decodeString<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
  write(chunk, encoding, next) { <span style="color:#998;font-style:italic">// å½“å†™å…¥çš„æ—¶å€™ä¼šè°ƒç”¨
</span><span style="color:#998;font-style:italic"></span>    console.log(chunk.toString())
    next();<span style="color:#998;font-style:italic">// å‘ŠçŸ¥è¯»å–æ›´å¤šæ•°æ®
</span><span style="color:#998;font-style:italic"></span>  }
}))
process.stdin.pipe(writableStream)
</code></pre></div><h3 id="æ¶ˆè´¹ä¸€ä¸ªå¯è¯»çš„æµconsume0jsconsume0js">æ¶ˆè´¹ä¸€ä¸ªå¯è¯»çš„æµï¼š<a href="./consume0.js">consume0.js</a><a href="#æ¶ˆè´¹ä¸€ä¸ªå¯è¯»çš„æµconsume0jsconsume0js" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#998;font-style:italic">//(echo abc; sleep 1; echo def; sleep 1; echo ghi) | node consume0.js 
</span><span style="color:#998;font-style:italic"></span>process.stdin.on(<span style="color:#d14">&#39;readable&#39;</span>, <span style="color:#000;font-weight:bold">function</span> () {
    <span style="color:#000;font-weight:bold">var</span> buf <span style="color:#000;font-weight:bold">=</span> process.stdin.read();<span style="color:#998;font-style:italic">// å¯ä»¥ç»™readä¼ å‚æ•° å‘ŠçŸ¥è¯»å–å‡ ä¸ªå­—èŠ‚
</span><span style="color:#998;font-style:italic"></span>    console.dir(buf);<span style="color:#998;font-style:italic">// æ‰“å°å¯¹è±¡æ‰€æœ‰å±æ€§
</span><span style="color:#998;font-style:italic"></span>    process.stdin.read(<span style="color:#099">0</span>); <span style="color:#998;font-style:italic">/// 0å‘ŠçŸ¥è¯»å–åç»­çš„æ‰€æœ‰å­—èŠ‚
</span><span style="color:#998;font-style:italic"></span>});
<span style="color:#998;font-style:italic">//output:
</span><span style="color:#998;font-style:italic">//&lt;Buffer 61 62 63 0a&gt; abc\0
</span><span style="color:#998;font-style:italic">//&lt;Buffer 64 65 66 0a&gt; def\0
</span><span style="color:#998;font-style:italic">//&lt;Buffer 67 68 69 0a&gt; ghi\0
</span></code></pre></div><p>ä½ ä¹Ÿå¯ä»¥åœ¨æ¶ˆè´¹è€…è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå†ç¼“å­˜å†…å®¹: <a href="./read1.js">read1.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> rs <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> (require(<span style="color:#d14">&#39;stream&#39;</span>).Readable);

<span style="color:#000;font-weight:bold">let</span> c <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">97</span>
rs._read <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>() { <span style="color:#998;font-style:italic">// å½“è¯»å–çš„æ—¶å€™ä¼šè°ƒç”¨
</span><span style="color:#998;font-style:italic"></span>  rs.push(<span style="color:#0086b3">String</span>.fromCharCode(c<span style="color:#000;font-weight:bold">++</span>))
  <span style="color:#000;font-weight:bold">if</span>(c <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#d14">&#39;z&#39;</span>.charCodeAt(<span style="color:#099">0</span>)) rs.push(<span style="color:#000;font-weight:bold">null</span>)
}

rs.pipe(process.stdout)


process.on(<span style="color:#d14">&#39;exit&#39;</span>, <span style="color:#000;font-weight:bold">function</span> () {
  console.error(<span style="color:#d14">&#39;\n_read() called &#39;</span> <span style="color:#000;font-weight:bold">+</span> (c <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">97</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39; times&#39;</span>);
});

</code></pre></div><p>ä»readableæµè¯»å–æ•°æ®ï¼š<a href="./read2.js">read2.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> Stream <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>)

<span style="color:#000;font-weight:bold">const</span> readableStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Stream.Readable({
  read() {}
})
<span style="color:#000;font-weight:bold">const</span> writableStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Stream.Writable()

writableStream._write <span style="color:#000;font-weight:bold">=</span> (chunk, encoding, next) =&gt; {
  console.log(chunk.toString())
  next()
}

readableStream.pipe(writableStream)
<span style="color:#998;font-style:italic">// or å› ä¸ºæ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ªEventEmitterï¼Œ æ‰€æœ‰è‡ªå¸¦ä¸€äº›åŸºæœ¬çš„äº‹ä»¶ï¼Œæ¯”å¦‚ï¼ˆclose...ï¼‰ å’Œæ‰©å±•çš„äº‹ä»¶
</span><span style="color:#998;font-style:italic">// readableStream.on(&#39;readable&#39;, () =&gt; {
</span><span style="color:#998;font-style:italic">//   console.log(readableStream.read().toString())
</span><span style="color:#998;font-style:italic">// })
</span><span style="color:#998;font-style:italic"></span>
readableStream.push(<span style="color:#d14">&#39;hi!&#39;</span>)
readableStream.push(<span style="color:#d14">&#39;ho!&#39;</span>)

</code></pre></div><h3 id="å†™å…¥æ•°æ®åˆ°å¯å†™çš„æµ-write1jswrite1js">å†™å…¥æ•°æ®åˆ°å¯å†™çš„æµï¼š <a href="./write1.js">write1.js</a><a href="#å†™å…¥æ•°æ®åˆ°å¯å†™çš„æµ-write1jswrite1js" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> Stream <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> writableStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Stream.Writable()

<span style="color:#998;font-style:italic">// var fs = require(&#39;fs&#39;);
</span><span style="color:#998;font-style:italic">// var ws = fs.createWriteStream(&#39;message.txt&#39;);
</span><span style="color:#998;font-style:italic"></span>writableStream.write(<span style="color:#d14">&#39;hey!\n&#39;</span>)

</code></pre></div><h3 id="å¦‚ä½•å…³é—­æµ-close1jsclose1js">å¦‚ä½•å…³é—­æµï¼š <a href="./close1.js">close1.js</a><a href="#å¦‚ä½•å…³é—­æµ-close1jsclose1js" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> Stream <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>)

<span style="color:#000;font-weight:bold">const</span> readableStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Stream.Readable({
  read() {}
})
<span style="color:#000;font-weight:bold">const</span> writableStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Stream.Writable()

writableStream._write <span style="color:#000;font-weight:bold">=</span> (chunk, encoding, next) =&gt; {
  console.log(chunk.toString())
  next()
}

writableStream.on(<span style="color:#d14">&#39;error&#39;</span>, (err) =&gt; {
  console.log(err)
})

readableStream.pipe(writableStream)

readableStream.push(<span style="color:#d14">&#39;hi!&#39;</span>)
readableStream.push(<span style="color:#d14">&#39;ho!&#39;</span>)

readableStream.on(<span style="color:#d14">&#39;close&#39;</span>, () =&gt; {
  writableStream.end()
  <span style="color:#998;font-style:italic">// writableStream.write(&#39;111&#39;) å…³é—­åå†å†™ä¼šè§¦å‘erroräº‹ä»¶ã€‚
</span><span style="color:#998;font-style:italic"></span>})<span style="color:#998;font-style:italic">// å…³é—­å¯å†™æµã€‚
</span><span style="color:#998;font-style:italic"></span>writableStream.on(<span style="color:#d14">&#39;close&#39;</span>, () =&gt; console.log(<span style="color:#d14">&#39;ended&#39;</span>))

readableStream.destroy() <span style="color:#998;font-style:italic">// é”€æ¯å¯è¯»æµã€‚ è§¦å‘closeäº‹ä»¶
</span><span style="color:#998;font-style:italic"></span>
</code></pre></div><h3 id="å¦‚ä½•åˆ›å»ºtransformæµ-transformjstransformjs">å¦‚ä½•åˆ›å»ºtransformæµï¼š <a href="./transform.js">transform.js</a><a href="#å¦‚ä½•åˆ›å»ºtransformæµ-transformjstransformjs" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> { Transform } <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> TransformStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Transform(({
  transform(chunk, encoding, callback) {
    <span style="color:#000;font-weight:bold">this</span>.push(chunk.toString().toUpperCase())
    callback()
  }
}));

process.stdin.pipe(TransformStream).pipe(process.stdout)

</code></pre></div><p>ä¸€èˆ¬ä¸ºäº†å‡å°‘æ¯æ¬¡å®ä¾‹åŒ–ï¼Œæˆ‘ä»¬ä¼šç”¨through2: through2.js</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#998;font-style:italic">// node through2.js hello.txt
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">const</span> f <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> through <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;through2&#39;</span>)
fs.createReadStream(process.argv[<span style="color:#099">2</span>]).pipe(toUpper()).pipe(process.stdout)

<span style="color:#000;font-weight:bold">function</span> toUpper() {
  <span style="color:#000;font-weight:bold">return</span> through(<span style="color:#000;font-weight:bold">function</span>(chunk, enc, next) {
    next(<span style="color:#000;font-weight:bold">null</span>, chunk.toString().toUpperCase())
    <span style="color:#998;font-style:italic">// or ä¸¤ä¸ªæ˜¯ç­‰ä»·çš„
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// this.push(chunk.toString().toUpperCase())
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// next()
</span><span style="color:#998;font-style:italic"></span>  })
}

</code></pre></div><h3 id="å¦‚ä½•åˆ›å»ºduplexæµ-duplexjsduplexjs">å¦‚ä½•åˆ›å»ºduplexæµï¼š <a href="./duplex.js">duplex.js</a><a href="#å¦‚ä½•åˆ›å»ºduplexæµ-duplexjsduplexjs" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#998;font-style:italic">// nc localhost 8000
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">const</span> net <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;net&#39;</span>) <span style="color:#998;font-style:italic">// create tcp server
</span><span style="color:#998;font-style:italic"></span>net.createServer(<span style="color:#000;font-weight:bold">function</span>(stream) {
  stream.pipe(stream)
}).listen(<span style="color:#099">8000</span>)
</code></pre></div><p>å¤æ‚çš„ä¾‹å­ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä»£ç†çš„æœåŠ¡å™¨ï¼Œä¸­é—´è½¬å‘ä¸€ä¸‹(æœ‰ç‚¹åƒvpn)ï¼šduplex2.js</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#998;font-style:italic">// nc localhost 8001 ç»“æœæ˜¯é€šè¿‡8000æœåŠ¡å™¨è½¬å‘çš„
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">const</span> net <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;net&#39;</span>) <span style="color:#998;font-style:italic">// create tcp server
</span><span style="color:#998;font-style:italic"></span>net.createServer(<span style="color:#000;font-weight:bold">function</span>(stream) {
  stream.pipe(net.connect(<span style="color:#099">8000</span>, <span style="color:#d14">&#39;localhost&#39;</span>)).pipe(stream)
}).listen(<span style="color:#099">8001</span>)
</code></pre></div><h3 id="å¯¹è±¡æµ-objectjsobjectjs">å¯¹è±¡æµ <a href="./object.js">object.js</a><a href="#å¯¹è±¡æµ-objectjsobjectjs" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ åªèƒ½è¯»å’Œå†™buffersï¼ˆæ¯”å¦‚æ–‡æœ¬æ–‡ä»¶ï¼‰ å’Œå­—ç¬¦ä¸²ã€‚ å¦‚æœè¦è¯»å–å¯¹è±¡ï¼Œ
éœ€è¦å¼€å¯å¯¹è±¡æ¨¡å¼</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> through <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;through2&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> tr <span style="color:#000;font-weight:bold">=</span> through.obj(<span style="color:#000;font-weight:bold">function</span>(row, enc, next) {
  next(<span style="color:#000;font-weight:bold">null</span>, (row.n <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">1000</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;\n&#39;</span>)
})
tr.pipe(process.stdout)
tr.write({ n<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">5</span> })
tr.write({ n<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">10</span> })
tr.write({ n<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">3</span> })
tr.end()
</code></pre></div><h3 id="å¦‚ä½•æŠŠæµç¼“å­˜èµ·æ¥ä¸€æ¬¡æ€§è¯»å–-concatjsconcatjs">å¦‚ä½•æŠŠæµç¼“å­˜èµ·æ¥ä¸€æ¬¡æ€§è¯»å–ï¼š <a href="./concat.js">concat.js</a><a href="#å¦‚ä½•æŠŠæµç¼“å­˜èµ·æ¥ä¸€æ¬¡æ€§è¯»å–-concatjsconcatjs" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> concat <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;concat-stream&#39;</span>)
process.stdin.pipe(concat(<span style="color:#000;font-weight:bold">function</span>(body) {
    console.log(body.length) <span style="color:#998;font-style:italic">//ctr+d ä¼šä¸€æ¬¡æ€§æ‰“å°å‡ºæ¥
</span><span style="color:#998;font-style:italic"></span>}))
</code></pre></div><p>å¤æ‚çš„åœºæ™¯ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­è¯·æ±‚å‚æ•°çš„é•¿åº¦: <a href="./concat2.js">concat2.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#998;font-style:italic">// curl -d msg=hello localhost:6000
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">const</span> concat <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;concat-stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> http <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;http&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> qs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;querystring&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> through <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;through2&#39;</span>)
<span style="color:#000;font-weight:bold">function</span> counter() {
  <span style="color:#000;font-weight:bold">let</span> size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
  <span style="color:#000;font-weight:bold">return</span> through(<span style="color:#000;font-weight:bold">function</span>(buf, enc, next) {
    size <span style="color:#000;font-weight:bold">+=</span> buf.length
    <span style="color:#000;font-weight:bold">if</span>(size <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">20</span>) next(<span style="color:#000;font-weight:bold">null</span>, <span style="color:#000;font-weight:bold">null</span>) <span style="color:#998;font-style:italic">// ç»ˆæ­¢æµ
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">else</span> next(<span style="color:#000;font-weight:bold">null</span>, buf)
  })
}

<span style="color:#000;font-weight:bold">const</span> server <span style="color:#000;font-weight:bold">=</span> http.createServer(<span style="color:#000;font-weight:bold">function</span>(req, res) {
    req
    .pipe(counter())
    .pipe(concat({ encoding<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;string&#39;</span> }, <span style="color:#000;font-weight:bold">function</span>(body) {
        <span style="color:#000;font-weight:bold">const</span> params <span style="color:#000;font-weight:bold">=</span> qs.parse(body) <span style="color:#998;font-style:italic">// è¯»å–çš„æ˜¯ç©º
</span><span style="color:#998;font-style:italic"></span>        console.log(params)
        res.end(<span style="color:#d14">&#39;ok\n&#39;</span>)
    }))
})

server.listen(<span style="color:#099">6000</span>)

</code></pre></div><h3 id="å†…ç½®çš„æµ">å†…ç½®çš„æµ<a href="#å†…ç½®çš„æµ" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<ul>
<li>process.stdin: å¯è¯»çš„æµ</li>
<li>process.stdoutï¼šå¯å†™çš„æµ</li>
<li>process.stderrï¼šå¯å†™çš„æµ</li>
<li>fs.createReadStream()</li>
<li>fs.createWriteStream()</li>
<li>net.connect()ï¼š Duplexæµ å»ºç«‹tcpè¿æ¥ç”¨çš„</li>
<li>net.createServer()</li>
<li>http.request()</li>
<li>http.createServer()</li>
<li>zlib.createGzip()</li>
<li>zlib.createGunzip() : gzipè§£å‹</li>
<li>zlib.createDeflate(): ç”¨deflateç®—æ³•å‹ç¼©</li>
<li>zlib.createInflate(): ç”¨deflateç®—æ³•è§£å‹</li>
<li>tls.connect()</li>
<li>tls.createServer()</li>
<li>child_process spawn: åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹</li>
</ul>
<p>å…¶ä»–å¸¸ç”¨çš„æµæ¨¡å—ï¼š</p>
<ul>
<li>crypto:  åŠ å¯†</li>
<li>zlibï¼š å‹ç¼©</li>
<li>split2ï¼š æŒ‰è¡Œè¿”å›æ•°æ®ï¼Œæ¯”å¦‚è¯»å–ä¸€ä¸ªæ–‡ä»¶</li>
<li>websocket-stream</li>
<li>collect-stream</li>
<li>from2: ç›´æ¥è½¬ä¸ºå¯è¯»æµ</li>
<li>to2ï¼š ç›´æ¥è½¬ä¸ºå¯å†™æµ</li>
<li>duplexify: æ”¯æŒå°†æµè½¬ä¸ºduplexç±»å‹</li>
<li>pump</li>
<li>pumpify</li>
<li>end-of-streamï¼š åˆ¤æ–­æµæ˜¯å¦ç»“æŸï¼Œæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°</li>
</ul>
<h4 id="collect-stream">collect-stream<a href="#collect-stream" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p><a href="./collect.js">collect.js</a></p>
<p>å’Œconcat-streamæ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œ åªä¸è¿‡å®ƒæœ‰å¼‚å¸¸å¤„ç†ã€‚ å¯ä»¥ç”¨äºå•å…ƒæµ‹è¯•</p>
<h4 id="duplexify">duplexify<a href="#duplexify" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p><a href="./duplify.js">duplify.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> duplexify <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;duplexify&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> fs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>)

<span style="color:#000;font-weight:bold">function</span> log() {
	<span style="color:#000;font-weight:bold">const</span> d <span style="color:#000;font-weight:bold">=</span> duplexify();
  <span style="color:#000;font-weight:bold">var</span> w <span style="color:#000;font-weight:bold">=</span> fs.createWriteStream(<span style="color:#d14">&#39;logs/test.log&#39;</span>)
  d.setWritable(w)
  <span style="color:#000;font-weight:bold">return</span> d
}

<span style="color:#000;font-weight:bold">const</span> stream <span style="color:#000;font-weight:bold">=</span> log();
stream.write(<span style="color:#0086b3">Date</span>.now() <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;\n&#39;</span>)
stream.end();
concat<span style="color:#000;font-weight:bold">-</span>stream

</code></pre></div><p>å¦‚ä½•æŠŠæµç¼“å­˜èµ·æ¥ä¸€æ¬¡æ€§è¯»å–: å°†æµè¾“å‡ºä¸ºä¸€ä¸ªbufferï¼› å¦‚æœæ˜¯å¯¹è±¡ï¼Œåˆ™æ˜¯å¯¹è±¡æ•°ç»„ã€‚</p>
<p>æ­£å¸¸å®ç°æ–¹å¼ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> ResponseReader(encoding) {
  stream.Transform.call(<span style="color:#000;font-weight:bold">this</span>);
  <span style="color:#000;font-weight:bold">this</span>._chuncks <span style="color:#000;font-weight:bold">=</span> [];
  <span style="color:#000;font-weight:bold">this</span>._encoding <span style="color:#000;font-weight:bold">=</span> encoding;
}
util.inherits(ResponseReader, stream.Transform);

ResponseReader.prototype._transform <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(chunk, encoding, callback) {
  <span style="color:#000;font-weight:bold">this</span>._chuncks.push(chunk);
  callback();
};

ResponseReader.prototype._flush  <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(callback) {
  <span style="color:#000;font-weight:bold">this</span>.push(Buffer.concat(<span style="color:#000;font-weight:bold">this</span>._chuncks).toString(<span style="color:#000;font-weight:bold">this</span>._encoding));
  callback();
};
 concat.js

<span style="color:#000;font-weight:bold">const</span> concat <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;concat-stream&#39;</span>)
process.stdin.pipe(concat(<span style="color:#000;font-weight:bold">function</span>(body) {
    console.log(body.length) <span style="color:#998;font-style:italic">//ctr+d ä¼šä¸€æ¬¡æ€§æ‰“å°å‡ºæ¥
</span><span style="color:#998;font-style:italic"></span>}))
</code></pre></div><p>å¤æ‚çš„åœºæ™¯ã€‚æ¯”å¦‚æˆ‘ä»¬å“åº”è¿”å›å®Œæ•´æ•°æ®(æ¯”å¦‚å›¾ç‰‡)æ‰è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ concat2.js
// curl -d msg=hello localhost:6000</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> concat <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;concat-stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> http <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;http&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> qs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;querystring&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> through <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;through2&#39;</span>)
<span style="color:#000;font-weight:bold">function</span> counter() {
  <span style="color:#000;font-weight:bold">let</span> size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
  <span style="color:#000;font-weight:bold">return</span> through(<span style="color:#000;font-weight:bold">function</span>(buf, enc, next) {
    size <span style="color:#000;font-weight:bold">+=</span> buf.length
    <span style="color:#000;font-weight:bold">if</span>(size <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">20</span>) next(<span style="color:#000;font-weight:bold">null</span>, <span style="color:#000;font-weight:bold">null</span>) <span style="color:#998;font-style:italic">// éœ€è¦åˆ¤æ–­è¯·æ±‚å‚æ•°çš„é•¿åº¦: è¶…è¿‡20 åˆ™ç»ˆæ­¢æµ
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">else</span> next(<span style="color:#000;font-weight:bold">null</span>, buf)
  })
}

<span style="color:#000;font-weight:bold">const</span> server <span style="color:#000;font-weight:bold">=</span> http.createServer(<span style="color:#000;font-weight:bold">function</span>(req, res) {
    req
    .pipe(counter())
    .pipe(concat({ encoding<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;string&#39;</span> }, <span style="color:#000;font-weight:bold">function</span>(body) {
        <span style="color:#000;font-weight:bold">const</span> params <span style="color:#000;font-weight:bold">=</span> qs.parse(body) <span style="color:#998;font-style:italic">// è¯»å–çš„æ˜¯ç©º
</span><span style="color:#998;font-style:italic"></span>        console.log(params)
        res.end(<span style="color:#d14">&#39;ok\n&#39;</span>)
    }))
})

server.listen(<span style="color:#099">6000</span>)

</code></pre></div><h4 id="pump">pump<a href="#pump" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p>è§£å†³10.xç‰ˆæœ¬å‰ï¼Œå½“ç›®æ ‡æµè¢«é”€æ¯çš„æ—¶å€™ï¼Œæºæµä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼Œä¹Ÿæ²¡æœ‰å›è°ƒçš„é—®é¢˜ã€‚å¤„ç†å¼‚å¸¸</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">var</span> pump <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;pump&#39;</span>)
<span style="color:#000;font-weight:bold">var</span> fs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>)

<span style="color:#000;font-weight:bold">var</span> source <span style="color:#000;font-weight:bold">=</span> fs.createReadStream(<span style="color:#d14">&#39;/dev/random&#39;</span>)
<span style="color:#000;font-weight:bold">var</span> dest <span style="color:#000;font-weight:bold">=</span> fs.createWriteStream(<span style="color:#d14">&#39;/dev/null&#39;</span>)

<span style="color:#998;font-style:italic">// source.pipe(dst) ä½†æ˜¯ä¼šæœ‰å¼‚å¸¸å‡½æ•°å›è°ƒ
</span><span style="color:#998;font-style:italic"></span>pump(source, dest, <span style="color:#000;font-weight:bold">function</span>(err) {
  console.log(<span style="color:#d14">&#39;pipe finished&#39;</span>, err)
})

setTimeout(<span style="color:#000;font-weight:bold">function</span>() {
  dest.destroy() <span style="color:#998;font-style:italic">// when dest is closed pump will destroy source
</span><span style="color:#998;font-style:italic"></span>}, <span style="color:#099">1000</span>)
</code></pre></div><p>10.xç‰ˆæœ¬åå¯ä»¥ç”¨pipeline</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> { pipeline } <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>);
<span style="color:#000;font-weight:bold">const</span> fs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>);
<span style="color:#000;font-weight:bold">const</span> zlib <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;zlib&#39;</span>);

<span style="color:#998;font-style:italic">// Use the pipeline API to easily pipe a series of streams
</span><span style="color:#998;font-style:italic">// together and get notified when the pipeline is fully done.
</span><span style="color:#998;font-style:italic"></span>
<span style="color:#998;font-style:italic">// A pipeline to gzip a potentially huge tar file efficiently:
</span><span style="color:#998;font-style:italic"></span>
pipeline(
  fs.createReadStream(<span style="color:#d14">&#39;archive.tar&#39;</span>),
  zlib.createGzip(),
  fs.createWriteStream(<span style="color:#d14">&#39;archive.tar.gz&#39;</span>),
  (err) =&gt; {
    <span style="color:#000;font-weight:bold">if</span> (err) {
      console.error(<span style="color:#d14">&#39;Pipeline failed.&#39;</span>, err);
    } <span style="color:#000;font-weight:bold">else</span> {
      console.log(<span style="color:#d14">&#39;Pipeline succeeded.&#39;</span>);
    }
  }
);

</code></pre></div><h4 id="pumpify">pumpify<a href="#pumpify" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p>pump and duplexify çš„ç»“åˆ ä¼šè¿”å›ä¸€ä¸ªduplexæµ</p>
<h4 id="rpc-stream">rpc-stream<a href="#rpc-stream" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p>RPCï¼ˆRemote Procedure Callï¼‰ä¸­æ–‡åã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€
å…¶å®å°±æ˜¯è°ƒç”¨å…¶ä»–æœºå™¨ä¸Šçš„å‡½æ•°ã€‚ä¸€èˆ¬æ˜¯åŸºäºTCPã€‚æ¯”å¦‚æˆ‘ä»¬é›†å›¢çš„HSF å…¶å®å°±æ˜¯ä¸€ä¸ªè¿œç¨‹è°ƒç”¨ã€‚æºç å¾ˆå€¼å¾—è¯»ä¸€è¯»ï¼Œå…³äºå¦‚ä½•è®¾è®¡å¥½çš„æ¥å£ã€‚</p>
<p><a href="./rpc-server.js">rpc-server.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> rpc <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;rpc-stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> net <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;net&#39;</span>)

net.createServer(<span style="color:#000;font-weight:bold">function</span> (stream) {
  <span style="color:#000;font-weight:bold">const</span> server <span style="color:#000;font-weight:bold">=</span> rpc({ <span style="color:#998;font-style:italic">// duplexç±»å‹
</span><span style="color:#998;font-style:italic"></span>    hello<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> (name, cb) {
      cb(<span style="color:#000;font-weight:bold">null</span>, <span style="color:#d14">&#39;hello, &#39;</span> <span style="color:#000;font-weight:bold">+</span> name)
    }
  })
  server.pipe(stream).pipe(server) <span style="color:#998;font-style:italic">//éœ€è¦ä¼ é€’ç»™server
</span><span style="color:#998;font-style:italic"></span>}).listen(<span style="color:#099">8001</span>)
</code></pre></div><p><a href="./rpc-client.js">rpc-client.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> rpc <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;rpc-stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> net <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;net&#39;</span>)

<span style="color:#000;font-weight:bold">const</span> client <span style="color:#000;font-weight:bold">=</span> rpc()
client.pipe(net.connect(<span style="color:#099">8001</span>, <span style="color:#d14">&#39;localhost&#39;</span>)).pipe(client) <span style="color:#998;font-style:italic">// éœ€è¦å†æ¬¡pipe(client)
</span><span style="color:#998;font-style:italic"></span>
<span style="color:#000;font-weight:bold">const</span> remote <span style="color:#000;font-weight:bold">=</span> client.wrap([<span style="color:#d14">&#39;hello&#39;</span>])

remote.hello(<span style="color:#d14">&#39;JIM&#39;</span>, <span style="color:#000;font-weight:bold">function</span> (err, mess) {
  <span style="color:#000;font-weight:bold">if</span>(err) <span style="color:#000;font-weight:bold">throw</span> err
  console.log(mess)
})

</code></pre></div><p>ç”¨rpcåè®®ä¸éœ€è¦jsonæ ¼å¼ã€‚è¿™ä¸ªæ˜¯ä¼˜åŠ¿ã€‚</p>
<h4 id="multiplex">multiplex<a href="#multiplex" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p>èƒ½å°†å¤šä¸ªæµæ‰“åŒ…æˆä¸€ä¸ªæµ <a href="./mul1.js">mul1.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> net <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;net&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> multiplex <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;multiplex&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> rpc <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;rpc-stream&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> fs <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;fs&#39;</span>)

net.createServer(<span style="color:#000;font-weight:bold">function</span> (stream) {
  <span style="color:#000;font-weight:bold">const</span> plex <span style="color:#000;font-weight:bold">=</span> multiplex()
  stream.pipe(plex).pipe(stream);
  <span style="color:#000;font-weight:bold">const</span> client <span style="color:#000;font-weight:bold">=</span> rpc({
    read<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span>(name , cb) {
      <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">!</span><span style="color:#009926">/^[\w-]+$/</span>.test(name)) {
        <span style="color:#000;font-weight:bold">return</span> cb(<span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">Error</span>(<span style="color:#d14">&#39;file not allowed&#39;</span>))
      }
      <span style="color:#000;font-weight:bold">const</span> r <span style="color:#000;font-weight:bold">=</span> fs.createReadStream(<span style="color:#d14">&#39;files/&#39;</span> <span style="color:#000;font-weight:bold">+</span> name)
      r.on(<span style="color:#d14">&#39;error&#39;</span>, cb)
      r.pipe(plex.createStream(<span style="color:#d14">&#39;file-&#39;</span><span style="color:#000;font-weight:bold">+</span>name)).pipe(r)
      cb(<span style="color:#000;font-weight:bold">null</span>)
    }
  })
  client.pipe(plex.createSharedStream(<span style="color:#d14">&#39;rpc&#39;</span>)).pipe(client)
}).listen(<span style="color:#099">8000</span>)
<span style="color:#998;font-style:italic">//node mul1-client.js hello
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">const</span> net <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;net&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> multiplex <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;multiplex&#39;</span>)
<span style="color:#000;font-weight:bold">const</span> rpc <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;rpc-stream&#39;</span>)

<span style="color:#000;font-weight:bold">const</span> plex <span style="color:#000;font-weight:bold">=</span> multiplex(<span style="color:#000;font-weight:bold">function</span>(stream, id) {
  <span style="color:#000;font-weight:bold">if</span>(<span style="color:#009926">/^file-/</span>.test(id)) {
    console.log(<span style="color:#d14">&#39;reveived file &#39;</span> <span style="color:#000;font-weight:bold">+</span> id.replace(<span style="color:#009926">/^file-/</span>, <span style="color:#d14">&#39;&#39;</span>))
    stream.pipe(process.stdout)
  }
})

plex.pipe(net.connect(<span style="color:#099">8000</span>)).pipe(plex)

<span style="color:#000;font-weight:bold">const</span> client <span style="color:#000;font-weight:bold">=</span> rpc()
client.pipe(plex.createSharedStream(<span style="color:#d14">&#39;rpc&#39;</span>)).pipe(client)
<span style="color:#000;font-weight:bold">const</span> remote <span style="color:#000;font-weight:bold">=</span> client.wrap([<span style="color:#d14">&#39;read&#39;</span>])
remote.read(process.argv[<span style="color:#099">2</span>], <span style="color:#000;font-weight:bold">function</span>(err) {
  <span style="color:#000;font-weight:bold">if</span>(err) console.error(err)
})

</code></pre></div><h3 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯<a href="#å®é™…åº”ç”¨åœºæ™¯" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<h4 id="1-æ–‡ä»¶ä¸‹è½½å¯¼å…¥å¯¼å‡º">1 æ–‡ä»¶ä¸‹è½½/å¯¼å…¥å¯¼å‡º<a href="#1-æ–‡ä»¶ä¸‹è½½å¯¼å…¥å¯¼å‡º" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p><a href="https://www.eggjs.org/api/node_modules_egg-multipart_app_extend_context.js.html">https://www.eggjs.org/api/node_modules_egg-multipart_app_extend_context.js.html</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> {
    ctx,
} <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>;
<span style="color:#000;font-weight:bold">const</span> parts <span style="color:#000;font-weight:bold">=</span> ctx.multipart();
<span style="color:#000;font-weight:bold">let</span> object;
<span style="color:#000;font-weight:bold">let</span> part;
part <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">yield</span> parts;
<span style="color:#000;font-weight:bold">while</span> (part) {
    <span style="color:#000;font-weight:bold">if</span> (part.length) {
        <span style="color:#998;font-style:italic">// arrays are busboy fields
</span><span style="color:#998;font-style:italic"></span>    } <span style="color:#000;font-weight:bold">else</span> {
        <span style="color:#998;font-style:italic">// otherwise, it&#39;s a stream
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// æ–‡ä»¶å¤„ç†ï¼Œä¸Šä¼ åˆ°äº‘å­˜å‚¨ç­‰ç­‰
</span><span style="color:#998;font-style:italic"></span>        object <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">yield</span> ctx.oss.put(<span style="color:#d14">&#39;egg-oss-demo-&#39;</span> <span style="color:#000;font-weight:bold">+</span> part.filename, part);
    }
    part <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">yield</span> parts;
}


</code></pre></div><h4 id="2-ç½‘ç»œä¼ è¾“æ¯”å¦‚ä»è¿œç«¯ä¸‹è½½æ–‡ä»¶">2 ç½‘ç»œä¼ è¾“ï¼šæ¯”å¦‚ä»è¿œç«¯ä¸‹è½½æ–‡ä»¶<a href="#2-ç½‘ç»œä¼ è¾“æ¯”å¦‚ä»è¿œç«¯ä¸‹è½½æ–‡ä»¶" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">yield</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">Promise</span>((resolve, reject)=&gt;{
  ctx.safeCurl(whitelistExcelLink).then(response =&gt; {
    <span style="color:#000;font-weight:bold">const</span> data <span style="color:#000;font-weight:bold">=</span> response.data;
    <span style="color:#000;font-weight:bold">const</span> stream <span style="color:#000;font-weight:bold">=</span> fs.createWriteStream(filepath)
    stream.write(data, () =&gt; {
      resolve <span style="color:#000;font-weight:bold">&amp;&amp;</span> resolve()
    });
  }).<span style="color:#000;font-weight:bold">catch</span>(e =&gt; {
    ctx.logger.error(e)
  });
});Â 

</code></pre></div><h4 id="3-vpn">3 vpn<a href="#3-vpn" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p>ä»£ç å¤ªå¤šï¼š è¯·æ‰“å¼€æ–‡ä»¶æŸ¥çœ‹ï¼š</p>
<p><a href="./vpn-client.js">vpn-client.js</a>
<a href="./vpn-server.js">vpn-server.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">node vpn-client.js
node vpn-server.js
node echo.js
</code></pre></div><h4 id="4-å®æ—¶é€šä¿¡-websocket">4 å®æ—¶é€šä¿¡ websocket<a href="#4-å®æ—¶é€šä¿¡-websocket" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p><a href="./websocket-client.js">websocket-client.js</a>
<a href="./websocket-server.js">websocket-server.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">browserify websocket-client.js &gt; public/bundle.js <span style="color:#000;font-weight:bold">(</span>æˆ–è€…nodejs clientä¹Ÿè¡Œï¼‰
node websocket-server.js
</code></pre></div><p>é—®é¢˜ï¼š websocketå’Œ<a href="https://github.com/socketio/socket.io/blob/master/lib/index.ts">socket.io</a>çš„åŒºåˆ«ï¼Ÿ</p>
<h4 id="5-p2p">5 p2p<a href="#5-p2p" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p>ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰æœåŠ¡æ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„å¹³å°ï¼Œä¸¤ä¸ªäººåœ¨æ­¤å¹³å°ä¸Šç›´æ¥äº’åŠ¨ï¼Œæ²¡æœ‰ç¬¬ä¸‰æ–¹çš„ä¸­ä»‹ã€‚<a href="./webrtc.js">webrtc.js</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">tnpm run signalhub
budo webrtc.js
</code></pre></div><p>é—®é¢˜ï¼š discordæ˜¯ä¸æ˜¯ç‚¹å¯¹ç‚¹ï¼Ÿ</p>
<h4 id="6-å·¥ç¨‹åŒ–">6 å·¥ç¨‹åŒ–<a href="#6-å·¥ç¨‹åŒ–" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<blockquote>
<p>gulp éœ€è¦é¢‘ç¹å¯¹æ–‡ä»¶æ“ä½œ</p>
</blockquote>
<h4 id="7-webassembly">7 webassembly<a href="#7-webassembly" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h4>
<p><a href="https://developers.google.com/web/updates/2018/04/loading-wasm">https://developers.google.com/web/updates/2018/04/loading-wasm</a></p>
<h3 id="æ‰©å±•">æ‰©å±•<a href="#æ‰©å±•" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h3>
<p>1 è‡ªå®šä¹‰å®ç°
å®ç°ä¸€ä¸ªwritableæµ
å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰äº† stream å†™å…¥çš„æ—¶æœºï¼Œå½“ chunk å¤§å°è¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼Œæ‰çœŸçš„å†™å…¥æ–‡ä»¶ï¼Œæå‡å†™å…¥é€Ÿåº¦</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#998;font-style:italic">// strace -cfe trace=write node index.js
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">var</span> Writable <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>).Writable;
<span style="color:#000;font-weight:bold">var</span> util <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;util&#39;</span>);

<span style="color:#000;font-weight:bold">function</span> MyWritable(options) {
    Writable.call(<span style="color:#000;font-weight:bold">this</span>, options);
} <span style="color:#998;font-style:italic">// æ„é€ å‡½æ•°
</span><span style="color:#998;font-style:italic"></span>util.inherits(MyWritable, Writable); <span style="color:#998;font-style:italic">// ç»§æ‰¿è‡ªWritable
</span><span style="color:#998;font-style:italic"></span>MyWritable.prototype._write <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(chunk, encoding, callback) {
    console.log(<span style="color:#d14">&#34;è¢«å†™å…¥çš„æ•°æ®æ˜¯:&#34;</span>, chunk.toString()); <span style="color:#998;font-style:italic">// æ­¤å¤„å¯å¯¹å†™å…¥çš„æ•°æ®è¿›è¡Œå¤„ç†
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//this.data.push(chunk); å…ˆç¼“å­˜
</span><span style="color:#998;font-style:italic"></span>    callback();<span style="color:#998;font-style:italic">// æœ€ç»ˆå†™å…¥
</span><span style="color:#998;font-style:italic"></span>};
process.stdin.pipe(<span style="color:#000;font-weight:bold">new</span> MyWritable()); <span style="color:#998;font-style:italic">// stdinä½œä¸ºè¾“å…¥æºï¼ŒMyWritableä½œä¸ºè¾“å‡ºæº
</span><span style="color:#998;font-style:italic"></span>å®ç°ä¸€ä¸ªreadableæµ
<span style="color:#000;font-weight:bold">const</span> Readable <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;stream&#39;</span>).Readable;

<span style="color:#998;font-style:italic">// Stream å®ç°
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">class</span> MyReadable <span style="color:#000;font-weight:bold">extends</span> Readable {
  constructor(dataSource, options) {
    <span style="color:#000;font-weight:bold">super</span>(options);
    <span style="color:#000;font-weight:bold">this</span>.dataSource <span style="color:#000;font-weight:bold">=</span> dataSource;
  }
  <span style="color:#998;font-style:italic">// ç»§æ‰¿äº† Readable çš„ç±»å¿…é¡»å®ç°è¿™ä¸ªå‡½æ•°
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// è§¦å‘ç³»ç»Ÿåº•å±‚å¯¹æµçš„è¯»å–
</span><span style="color:#998;font-style:italic"></span>  _read() {
    <span style="color:#000;font-weight:bold">const</span> data <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.dataSource.makeData();
    <span style="color:#000;font-weight:bold">this</span>.push(data);
  }
}

</code></pre></div><p>å®ç°pipe</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">Readable.prototype.pipe <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(writable, options) {
  <span style="color:#000;font-weight:bold">this</span>.on(<span style="color:#d14">&#39;data&#39;</span>, (chunk) =&gt; {
    <span style="color:#000;font-weight:bold">let</span> ok <span style="color:#000;font-weight:bold">=</span> writable.write(chunk);
    <span style="color:#998;font-style:italic">// èƒŒå‹ï¼Œæš‚åœ
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">!</span>ok <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">this</span>.pause();
  });
  writable.on(<span style="color:#d14">&#39;drain&#39;</span>, () =&gt; {
    <span style="color:#998;font-style:italic">// æ¢å¤
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">this</span>.resume();
  });
  <span style="color:#998;font-style:italic">// å‘Šè¯‰ writable æœ‰æµè¦å¯¼å…¥
</span><span style="color:#998;font-style:italic"></span>  writable.emit(<span style="color:#d14">&#39;pipe&#39;</span>, <span style="color:#000;font-weight:bold">this</span>);
  <span style="color:#998;font-style:italic">// æ”¯æŒé“¾å¼è°ƒç”¨
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> writable;
};

</code></pre></div><p>2 å…³æ³¨å¤§ä½¬ï¼š</p>
<p><a href="https://github.com/substack">https://github.com/substack</a>
<a href="https://github.com/nodejs/readable-stream">https://github.com/nodejs/readable-stream</a></p>
<p>3 å¯è§†åŒ–ç†è§£streamsæ¦‚å¿µ<br>
<a href="https://blog.insiderattack.net/a-visual-guide-to-nodejs-streams-9d2d594a9bf5?gi=5c2a70f05af9">https://blog.insiderattack.net/a-visual-guide-to-nodejs-streams-9d2d594a9bf5?gi=5c2a70f05af9</a></p>
<h2 id="å‚è€ƒ">å‚è€ƒ<a href="#å‚è€ƒ" class="hanchor" ariaLabel="Anchor"> ğŸ”—&#xFE0E;</a> </h2>
<p><a href="https://nodejs.org/api/stream.html#stream">https://nodejs.org/api/stream.html#stream</a><br>
<a href="https://nodejs.dev/learn/nodejs-streams">https://nodejs.dev/learn/nodejs-streams</a><br>
<a href="https://nodesource.com/blog/understanding-streams-in-nodejs/">https://nodesource.com/blog/understanding-streams-in-nodejs/</a><br>
<a href="https://nodejs.org/api/stream.html">https://nodejs.org/api/stream.html</a><br>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array</a><br>
<a href="https://frontendmasters.com/courses/networking-streams/">https://frontendmasters.com/courses/networking-streams/</a></p>

      </div>

<style type="text/css">

   
  #mc_embed_signup form {display:block; position:relative; text-align:left; padding:10px 0 10px 3%}
  #mc_embed_signup h2 {font-weight:bold; padding:0; margin:15px 0; font-size:1.4em;}
  #mc_embed_signup input {border: 1px solid #ABB0B2; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
  #mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox;}
  #mc_embed_signup input[type=radio]{-webkit-appearance:radio;}
  #mc_embed_signup input:focus {border-color:#333;}
  #mc_embed_signup .button {clear:both; background-color: #aaa; border: 0 none; border-radius:4px; transition: all 0.23s ease-in-out 0s; color: #FFFFFF; cursor: pointer; display: inline-block; font-size:15px; font-weight: normal; height: 32px; line-height: 32px; margin: 0 5px 10px 0; padding: 0 22px; text-align: center; text-decoration: none; vertical-align: top; white-space: nowrap; width: auto;}
  #mc_embed_signup .button:hover {background-color:#777;}
  #mc_embed_signup .small-meta {font-size: 11px;}
  #mc_embed_signup .nowrap {white-space:nowrap;}

  #mc_embed_signup .mc-field-group {clear:left; position:relative; width:96%; padding-bottom:3%; min-height:50px;}
  #mc_embed_signup .size1of2 {clear:none; float:left; display:inline-block; width:46%; margin-right:4%;}
  * html #mc_embed_signup .size1of2 {margin-right:2%;  }
  #mc_embed_signup .mc-field-group label {display:block; margin-bottom:3px;}
  #mc_embed_signup .mc-field-group input {display:block; width:100%; padding:8px 0; text-indent:2%;}
  #mc_embed_signup .mc-field-group select {display:inline-block; width:99%; padding:5px 0; margin-bottom:2px;}

  #mc_embed_signup .datefield, #mc_embed_signup .phonefield-us{padding:5px 0;}
  #mc_embed_signup .datefield input, #mc_embed_signup .phonefield-us input{display:inline; width:60px; margin:0 2px; letter-spacing:1px; text-align:center; padding:5px 0 2px 0;}
  #mc_embed_signup .phonefield-us .phonearea input, #mc_embed_signup .phonefield-us .phonedetail1 input{width:40px;}
  #mc_embed_signup .datefield .monthfield input, #mc_embed_signup .datefield .dayfield input{width:30px;}
  #mc_embed_signup .datefield label, #mc_embed_signup .phonefield-us label{display:none;}

  #mc_embed_signup .indicates-required {text-align:right; font-size:11px; margin-right:4%;}
  #mc_embed_signup .asterisk {color:#e85c41; font-size:150%; font-weight:normal; position:relative; top:5px;}
  #mc_embed_signup .clear {clear:both;}

  #mc_embed_signup .mc-field-group.input-group ul {margin:0; padding:5px 0; list-style:none;}
  #mc_embed_signup .mc-field-group.input-group ul li {display:block; padding:3px 0; margin:0;}
  #mc_embed_signup .mc-field-group.input-group label {display:inline;}
  #mc_embed_signup .mc-field-group.input-group input {display:inline; width:auto; border:none;}

  #mc_embed_signup div#mce-responses {float:left; top:-1.4em; padding:0em .5em 0em .5em; overflow:hidden; width:90%; margin: 0 5%; clear: both;}
  #mc_embed_signup div.response {margin:1em 0; padding:1em .5em .5em 0; font-weight:bold; float:left; top:-1.5em; z-index:1; width:80%;}
  #mc_embed_signup #mce-error-response {display:none;}
  #mc_embed_signup #mce-success-response {color:#529214; display:none;}
  #mc_embed_signup label.error {display:block; float:none; width:auto; margin-left:1.05em; text-align:left; padding:.5em 0;}

  #mc-embedded-subscribe {clear:both; width:auto; display:block; margin:1em 0 1em 5%;}
  #mc_embed_signup #num-subscribers {font-size:1.1em;}
  #mc_embed_signup #num-subscribers span {padding:.5em; border:1px solid #ccc; margin-right:.5em; font-weight:bold;}

  #mc_embed_signup #mc-embedded-subscribe-form div.mce_inline_error {display:inline-block; margin:2px 0 1em 0; padding:5px 10px; background-color:rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size:14px; font-weight:normal; z-index:1; color:#e85c41;}
  #mc_embed_signup #mc-embedded-subscribe-form input.mce_inline_error {border:2px solid #e85c41;}
   
  .colorscheme-dark #mc_embed_signup { background:#212121; border: 1px solid; }
  .colorscheme-dark input[type=email] { background: #181818; color:silver; }
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
	 
</style>
<div id="mc_embed_signup">
  <form action="https://gmail.us5.list-manage.com/subscribe/post?u=c3b0164459768548b7bef380c&amp;id=1103acd526" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	
  <h3 style='text-align: center;'>å½“å‘å¸ƒå¾ˆé…·çš„ä¸œè¥¿æ—¶ï¼Œè¯·ç¬¬ä¸€æ—¶é—´é€šçŸ¥æˆ‘</h3>
  <p style='text-align: center;'>è®¢é˜…ç”µå­é‚®ä»¶ï¼Œä»¥è·å¾—æˆ‘çš„æœ€æ–°æ–‡ç« ã€‚</p>

<div class="mc-field-group">
	<label for="mce-EMAIL">é‚®ç®±åœ°å€  <span class="asterisk">*</span>
</label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_c3b0164459768548b7bef380c_1103acd526" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="è®¢é˜…" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>


      <section class="social-sharing">

  <h4>åˆ†äº«åˆ°</h4>

  <a href="https://twitter.com/intent/tweet?via=maoxunxing&text=NodeJS%20Stream%e4%bb%8e%e5%85%a5%e9%97%a8%e5%88%b0%e7%b2%be%e9%80%9a%20https%3a%2f%2fmaoxunxing.com%2fzh-cn%2fnodejs-network-stream%2f" class="btn btn-twitter btn-social" title="Share on Twitter">
    <i class="fab fa-fw fa-twitter" aria-hidden="true"></i>
    <span>Twitter</span>
  </a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmaoxunxing.com%2fzh-cn%2fnodejs-network-stream%2f" class="btn btn-facebook btn-social" title="Share on Facebook">
    <i class="fab fa-fw fa-facebook" aria-hidden="true"></i>
    <span> Facebook</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmaoxunxing.com%2fzh-cn%2fnodejs-network-stream%2f" class="btn btn-linkedin btn-social" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i>
    <span> LinkedIn</span>
  </a>

</section>


      


      <style>
  .utterances {
    max-width: initial !important;
    margin-top: 40px;
  }
</style>
<script src="https://utteranc.es/client.js"
        repo="XingMXTeam/XingMXTeam.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


      
        <script>
  talkyardServerUrl='';
  talkyardLogLevel = 'warn';
</script>
<script async defer src=""></script>
<section>
  <div class="talkyard-comments" data-discussion-id="" style="margin-top: 45px;">
    <noscript>Please enable JavaScript to view comments.</noscript>
  </div>
</section>

      

      <footer>
        


      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color: inherit;">CC BY-NC-SA 4.0</a>
      2022
      Â©
       Xunxing Mao 
    
    
    
  </section>
</footer>



    </main>


    
      
      <script src="https://maoxunxing.com/js/coder.min.158f22d7bc754e28d7c61accc0aef7952c2b949889ec9503466e5d4db0548808.js" integrity="sha256-FY8i17x1TijXxhrMwK73lSwrlJiJ7JUDRm5dTbBUiAg="></script>
    

    
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-199510588-1', 'auto');

  ga('require', 'outboundLinkTracker');

  ga('send', 'pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" async></script>



  </body>

</html>
